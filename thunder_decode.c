#include <stdio.h>
#include <string.h>

static char base64_decode_map[256] = {
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 62, 255, 255, 255, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 255, 255,
        255, 0, 255, 255, 255, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,
        15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 255, 255, 255, 255, 255, 255, 26, 27, 28,
        29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48,
        49, 50, 51, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255};

void thunder_decode(char *srctr, char **dstr)
{
        int i = 0, j = 0, src_len = 0;
        char src[4096], dst[4096];
        char *tail = NULL, *tmp = NULL;

        memset(src, 0, 4096);
        memset(dst, 0, 4096);

        sprintf(src, "%s",srctr+10);
        tail = strrchr(src, '/');
        if ((tail != NULL) && (*(tail+1) == '\0')){
                *tail = '\0';
        }
        src_len = strlen(src);

        for (; i < src_len; i += 4){
                dst[j++] = base64_decode_map[src[i]] << 2 |
                        base64_decode_map[src[i + 1]] >> 4;
                dst[j++] = base64_decode_map[src[i + 1]] << 4 |
                        base64_decode_map[src[i + 2]] >> 2;
                dst[j++] = base64_decode_map[src[i + 2]] << 6 |
                        base64_decode_map[src[i + 3]];
        }

        printf("%s\n", dst);
        tmp = strrchr(dst, 'Z');
        if (tmp != NULL)
                *(tmp-1) = '\0';
        printf("%s\n", dst+2);
        *dstr = strdup(dst+2);
}

int main(int argc, char *argv[])
{
        char *dstr = NULL;
        thunder_decode(argv[1], &dstr);

        return 0;
}
